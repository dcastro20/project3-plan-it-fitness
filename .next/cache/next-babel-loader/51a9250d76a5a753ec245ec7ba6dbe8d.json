{"ast":null,"code":"import nextConnect from 'next-connect';\nimport bcrypt from 'bcryptjs';\nimport middleware from '../../../../middlewares/middleware';\nconst handler = nextConnect();\nhandler.use(middleware);\nhandler.put(async (req, res) => {\n  if (!req.user) {\n    res.json(401).send('you need to be authenticated');\n    return;\n  }\n\n  const {\n    oldPassword,\n    newPassword\n  } = req.body;\n\n  if (!(await bcrypt.compare(oldPassword, req.user.password))) {\n    res.status(401).send('The password you has entered is incorrect.');\n  }\n\n  const password = await bcrypt.hash(newPassword, 10);\n  await req.db.collection('users').updateOne({\n    _id: req.user._id\n  }, {\n    $set: {\n      password\n    }\n  });\n  res.end('ok');\n});\nexport default handler;","map":null,"metadata":{},"sourceType":"module"}