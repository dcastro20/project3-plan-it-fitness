{"ast":null,"code":"import crypto from 'crypto';\nimport sgMail from '@sendgrid/mail';\nimport nextConnect from 'next-connect';\nimport middleware from '../../../../middlewares/middleware';\nsgMail.setApiKey(process.env.SENDGRID_API_KEY);\nconst handler = nextConnect();\nhandler.use(middleware);\nhandler.post(async (req, res) => {\n  if (!req.user) {\n    res.json(401).send('you need to be authenticated');\n    return;\n  }\n\n  const token = crypto.randomBytes(32).toString('hex');\n  await req.db.collection('tokens').insertOne({\n    token,\n    userId: req.user._id,\n    type: 'emailVerify',\n    expireAt: new Date(Date.now() + 1000 * 60 * 60 * 24)\n  });\n  const msg = {\n    to: req.user.email,\n    from: process.env.EMAIL_FROM,\n    html: `\n      <div>\n        <p>Hello, ${req.user.name}</p>\n        <p>Please follow <a href=\"${process.env.WEB_URI}/verify-email/${token}\">this link</a> to confirm your email.</p>\n      </div>\n      `\n  };\n  await sgMail.send(msg);\n  res.end('ok');\n});\nexport default handler;","map":null,"metadata":{},"sourceType":"module"}