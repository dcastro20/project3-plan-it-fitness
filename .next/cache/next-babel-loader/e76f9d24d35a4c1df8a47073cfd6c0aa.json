{"ast":null,"code":"import _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport Head from 'next/head';\nimport nextConnect from 'next-connect';\nimport database from '../../middlewares/database';\nexport default function EmailVerifyPage({\n  success\n}) {\n  return __jsx(React.Fragment, null, __jsx(Head, null, __jsx(\"title\", {\n    className: \"jsx-3269325724\"\n  }, \"Sign up\")), __jsx(_JSXStyle, {\n    id: \"3269325724\"\n  }, [\"p.jsx-3269325724{text-align:center;}\"]), __jsx(\"p\", {\n    className: \"jsx-3269325724\"\n  }, success ? 'Thank you for verifying your email address. You may close this page.' : 'This link may have been expired.'));\n}\nexport async function getServerSideProps(ctx) {\n  const handler = nextConnect();\n  handler.use(database);\n  await handler.apply(ctx.req, ctx.res);\n  const {\n    token\n  } = ctx.query;\n  const {\n    value: tokenDoc\n  } = await ctx.req.db.collection('tokens').findOneAndDelete({\n    token,\n    type: 'emailVerify'\n  });\n\n  if (!tokenDoc) {\n    return {\n      props: {\n        success: false\n      }\n    };\n  }\n\n  await ctx.req.db.collection('users').updateOne({\n    _id: tokenDoc.userId\n  }, {\n    $set: {\n      emailVerified: true\n    }\n  });\n  return {\n    props: {\n      success: true\n    }\n  };\n}","map":null,"metadata":{},"sourceType":"module"}