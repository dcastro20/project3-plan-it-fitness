{"ast":null,"code":"import { MongoClient } from 'mongodb';\nconst client = new MongoClient(process.env.MONGODB_URI, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n});\nexport async function setUpDb(db) {\n  db.collection('tokens').createIndex({\n    expireAt: -1\n  }, {\n    expireAfterSeconds: 0\n  });\n  db.collection('posts').createIndex({\n    createdAt: -1\n  });\n  db.collection('users').createIndex({\n    email: 1\n  }, {\n    unique: true\n  });\n}\nexport default async function database(req, res, next) {\n  if (!client.isConnected()) await client.connect();\n  req.dbClient = client;\n  req.db = client.db(process.env.DB_NAME);\n  await setUpDb(req.db);\n  return next();\n}","map":null,"metadata":{},"sourceType":"module"}